# Clippy Configuration for Aprender
# Enforces Toyota Way quality standards

# Disallow dangerous methods that can cause panics
# NOTE: Temporarily disabled for CI - see GH-41 for unwrap() remediation plan
# Uncomment when unwrap() elimination is complete
# disallowed-methods = [
#     # unwrap() can panic and crash the process (Cloudflare 2025-11-18 class defect)
#     { path = "core::option::Option::unwrap", reason = "Use .expect() with descriptive message or proper error handling with ?. See GH-41." },
#     { path = "core::result::Result::unwrap", reason = "Use .expect() with descriptive message or proper error handling with ?. See GH-41." },
#
#     # Other panic-inducing methods
#     { path = "core::option::Option::unwrap_or_default", reason = "Use .unwrap_or() or .unwrap_or_else() to make the default explicit." },
#     { path = "core::result::Result::unwrap_err", reason = "Use .expect_err() with descriptive message or proper error handling." },
# ]

# Additional lint configuration
# Cognitive complexity threshold (Toyota Way: â‰¤15)
cognitive-complexity-threshold = 15

# Type complexity threshold
type-complexity-threshold = 250

# Allowed names for single-character variables (mathematical notation)
allowed-idents-below-min-chars = ["x", "y", "i", "j", "k", "n", "m", "a", "b", "c"]

# Minimum identifier length (allow single chars for math)
min-ident-chars-threshold = 1

# LAYOUT-001: Column-major kernel bans (PMAT-243)
# APR is exclusively row-major. Column-major kernels produce garbage output.
# See: contracts/tensor-layout-v1.yaml, GH-202, GH-208
[[disallowed-methods]]
path = "trueno::backends::q4k::colmajor::matmul_q4k_f32_colmajor"
reason = "LAYOUT-001: APR is exclusively row-major. Use fused_q4k_parallel_matvec. See GH-202."

[[disallowed-methods]]
path = "trueno::backends::q4k::colmajor::matmul_q4k_f32_colmajor_dispatch"
reason = "LAYOUT-001: APR is exclusively row-major. Use fused_q4k_parallel_matvec. See GH-202."

[[disallowed-methods]]
path = "trueno::backends::q6k::colmajor::matmul_q6k_f32_colmajor"
reason = "LAYOUT-001: APR is exclusively row-major. Use fused_q6k_parallel_matvec. See GH-202."

[[disallowed-methods]]
path = "trueno::backends::q6k::colmajor::matmul_q6k_f32_colmajor_dispatch"
reason = "LAYOUT-001: APR is exclusively row-major. Use fused_q6k_parallel_matvec. See GH-202."
