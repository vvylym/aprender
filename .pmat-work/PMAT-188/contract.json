{
  "work_item_id": "PMAT-188",
  "github_issue": 178,
  "title": "GH-178: apr validate incorrectly rejects valid GGUF v3 files",
  "created_at": "2026-01-30T00:00:00Z",
  "status": "completed",
  "completed_at": "2026-01-30T00:00:00Z",
  "severity": "P2",
  "approach": "Update validator to recognize GGUF magic bytes and support versions 1-3",
  "five_whys": [
    "WHY does apr validate reject valid GGUF files? → Validator only checks for APR magic bytes",
    "WHY only APR magic bytes? → Original validator was APR-format specific",
    "WHY APR-specific? → Validation was designed for APR format before GGUF support",
    "WHY no GGUF version check? → Missing format detection in validate_structure()",
    "ROOT CAUSE: Validator lacks format-aware magic byte checking and GGUF version validation"
  ],
  "toyota_way_principle": "Jidoka - Build quality in with proper format detection",
  "implementation": {
    "phases": [
      "Phase 1: Update check_magic() to accept both APR and GGUF magic bytes",
      "Phase 2: Add check_gguf_version() to support GGUF v1, v2, v3",
      "Phase 3: Update validate_structure() to detect format and route appropriately",
      "Phase 4: Add GGUF-specific unit tests"
    ],
    "files_to_modify": [
      "src/format/validation.rs"
    ]
  },
  "falsification_gates": [
    "F-GGUF-MAG-001: GGUF magic bytes [71,71,85,70] accepted",
    "F-GGUF-V1-001: GGUF version 1 passes validation",
    "F-GGUF-V2-001: GGUF version 2 passes validation",
    "F-GGUF-V3-001: GGUF version 3 passes validation",
    "F-GGUF-VX-001: Invalid GGUF version (e.g., v99) fails validation"
  ],
  "deliverables": {
    "code": ["src/format/validation.rs"],
    "tests": ["7 GGUF-specific unit tests"]
  }
}
