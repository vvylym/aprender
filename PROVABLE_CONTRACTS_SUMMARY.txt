================================================================================
PROVABLE CONTRACTS SYSTEM â€” QUICK REFERENCE
================================================================================

TOTAL: 89 YAML contracts, 13,178 lines, 284 bindings (97.5% implemented)

TIER 1: KERNEL CONTRACTS (26/26) âœ… 100% COMPLETE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Attention       â†’ attention, gqa, flash-attention, sliding-window
Activation      â†’ gelu, relu, silu, swiglu
Normalization   â†’ layernorm, rmsnorm, batchnorm
Position        â†’ rope, absolute, alibi
Quantization    â†’ matmul, q4k-q6k, f16-conversion
Loss/Optim      â†’ cross-entropy, softmax, adamw, lbfgs
Other           â†’ bias-add, dropout, attention-scaling, projections

TIER 2: ARCHITECTURE CONTRACTS (20/20) âœ… 100% COMPLETE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model-config-algebra          â†’ Divisibility, bounds, ordering
arch-constraints              â†’ Per-architecture normalization/activation
qwen2-shapes, qwen3-shapes    â†’ Concrete dimension + RoPE frequency
qwen35-hybrid-forward         â†’ Hybrid decoder/SSM architecture
rope-extrapolation            â†’ YaRN, NTK scaling techniques
gated-delta-net               â†’ Qwen3.5 SSM kernel

TIER 3: ML ALGORITHMS (16/16) âœ… 100% COMPLETE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Linear/Tree-Based/Clustering/Reduction/Bayesian/Metrics
All formalized with proof obligations + falsification tests

TIER 4: TIME SERIES / SPECIALIZED (8/8) âœ… 100% COMPLETE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ARIMA, Drift Detection, Active Learning, CMA-ES, Metaheuristics,
Shannon Entropy, Optimization, Performance Grading

TIER 5: DATA/FORMAT CONTRACTS (9/11) âš ï¸ 82% COMPLETE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… aprender/tensor-layout-v1.yaml      â†’ ROW-MAJOR enforcement, GGUF transpose
âœ… aprender/quantized-dot-product-v1   â†’ Q4K/Q6K superblock semantics
âœ… aprender/binding.yaml               â†’ 284 kernelâ†’function bindings
âœ… aprender/kernel-fusion-v1.yaml      â†’ Fused operations
âœ… aprender/layer-parity-v1.yaml       â†’ Training vs inference consistency
âœ… format-parity-v1.yaml               â†’ GGUF â†” SafeTensors â†” APR
âœ… kv-cache-equivalence-v1.yaml        â†’ Cached vs non-cached inference
âœ… kv-cache-sizing-v1.yaml             â†’ Memory bounds
âœ… validated-tensor-v1.yaml            â†’ Poka-yoke newtype validation
âš ï¸ inference-pipeline-v1.yaml          â†’ MISSING: tokenizer, token generation
âš ï¸ tensor-inventory-v1.yaml            â†’ PARTIAL: only LLaMA names, missing Qwen/Mistral/Phi

TIER 6: E2E VERIFICATION (4/8) âš ï¸ 50% COMPLETE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… qwen2-e2e-verification      â†’ Forward pass golden output
âœ… qwen35-e2e-verification     â†’ Hybrid decoder+SSM
âœ… qwen3-e2e-verification      â†’ Dense forward
âœ… qwen3moe-e2e-verification   â†’ Sparse routing
âš ï¸ backend-dispatch            â†’ PARTIAL: missing GPUâ†”CPU equivalence
âš ï¸ roofline-model              â†’ PARTIAL: missing kernel benchmarks
âš ï¸ hybrid-layer-dispatch       â†’ PARTIAL: missing routing verification
âš ï¸ kernel-launch-budget        â†’ PARTIAL: missing cost model

================================================================================
CRITICAL GAPS â€” MISSING CONTRACTS (8 NEEDED)
================================================================================

P0 â€” PUBLISHING BLOCKERS (MUST HAVE) ğŸ”´
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. âŒ special-tokens-registry-v1.yaml
   - EOS/BOS/PAD IDs for all 101+ models
   - Currently hardcoded in: format/converter/tokenizer_loader.rs
   - Risk: Wrong EOS ID â†’ infinite token generation loops
   - Status: 0 lines / Should be: 500 lines
   
2. âŒ model-metadata-bounds-v1.yaml
   - Vocab size, head dim, rope_theta, max_position bounds
   - Currently: Ad-hoc checks in format/converter/gguf_import.rs
   - Formalizes F-QA-008 metadata plausibility gate
   - Status: 0 lines / Should be: 300 lines

3. âŒ tokenizer-vocab-v1.yaml
   - Per-model vocab size + BPE merge rule ordering
   - Currently hardcoded in: text/bpe/qwen2.rs, text/llama_tokenizer/mod.rs
   - Risk: Corrupted BPE â†’ wrong encoding
   - Status: 0 lines / Should be: 400 lines

P1 â€” QUALITY IMPROVEMENTS (SHOULD HAVE) ğŸŸ 
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

4. âŒ chat-template-semantics-v1.yaml
   - Grammar for ChatML, HF, Mistral, Phi, Zephyr (6+ formats)
   - Currently: Heuristic detection in chat_template/raw_template.rs
   - Risk: Silently wrong format â†’ garbage token sequences
   - Status: 0 lines / Should be: 600 lines

5. âš ï¸ tensor-inventory-v1.yaml EXPANSION
   - Add Qwen, Mistral, Phi naming rules
   - Currently: Only LLaMA documented
   - Risk: apr convert fails on non-LLaMA models
   - Status: Partial / Should be: +300 lines

6. âš ï¸ format-parity-v1.yaml EXPANSION
   - Add transposition proof (GGUF col-major â†’ APR row-major)
   - Add quantization equivalence (GGUF Q4_K vs APR Q4)
   - Related bugs: GH-208, GH-205, PMAT-234
   - Status: Partial / Should be: +400 lines

P2 â€” FUTURE PROOFING (NICE TO HAVE) ğŸŸ¡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

7. âš ï¸ backend-dispatch-v1.yaml EXPANSION
   - GPU â†” CPU numeric equivalence bounds
   - Enable automatic backend selection

8. âš ï¸ kernel-launch-budget-v1.yaml EXPANSION
   - GPU kernel cost model
   - Automatic kernel selection

================================================================================
HARDCODED VALUES NEEDING CONTRACTIFICATION
================================================================================

VOCAB SIZES (NO CONTRACT)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Qwen2:         151643
Qwen3:         152000
Qwen3-Coder:   152000
Qwen3.5:       152064
LLaMA 3.2:     128000
Mistral:       32000
Phi-3:         32064
Whisper:       51864

â†’ Should be in: special-tokens-registry-v1.yaml

SPECIAL TOKEN IDs (NO CONTRACT)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Qwen2:   pad=151643, eos=151643, bos=151644
LLaMA:   pad=128001, eos=128001, bos=128000
Mistral: pad=0, eos=2, bos=1
Phi-3:   pad=32064, eos=32064, bos=1

â†’ Should be in: special-tokens-registry-v1.yaml

RoPE THETA (PARTIALLY CONTRACTED)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Qwen2:   1,000,000.0     (in qwen2-shapes-v1.yaml âœ…)
LLaMA:   500,000.0       (in arch-constraints-v1.yaml âœ…)
Mistral: 10,000.0        (MISSING)
Phi-3:   10,000.0        (MISSING)

â†’ Should be in: model-metadata-bounds-v1.yaml

CHAT TEMPLATE MARKERS (NO CONTRACT)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ChatML:     "<|im_start|>" / "<|im_end|>"
Mistral:    "[INST] " / " [/INST]"
Zephyr:     "<|user|>" / "<|assistant|>"

â†’ Should be in: chat-template-semantics-v1.yaml

TENSOR NAMES (PARTIALLY CONTRACTED)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
LLaMA:    q_proj, k_proj, v_proj, o_proj            âœ… in tensor-inventory
Qwen:     c_attn[QKV], c_proj, w2[down], w1[gate]   âŒ MISSING
Mistral:  q_proj, k_proj, v_proj, o_proj, w1, v_proj, w2  âŒ MISSING
Phi:      q_proj, k_proj, v_proj, o_proj, fc1, fc2  âŒ MISSING

â†’ Should be in: tensor-inventory-v1.yaml expansion

================================================================================
SUMMARY TABLE
================================================================================

Component          Contracts  % Complete  Blocker?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Kernels            26         100% âœ…     No
Architecture       20         100% âœ…     No
ML Algorithms      16         100% âœ…     No
Time Series        8          100% âœ…     No
Data/Format        11         82% âš ï¸      No (2 partial)
E2E Verify         8          50% âš ï¸      No
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Tokenizers         0          0% âŒ       YES â€” P0
Metadata Bounds    0          0% âŒ       YES â€” P0
Chat Templates     0          0% âŒ       No (heuristic works)
Tensor Names       1 (partial) 33%       No (LLaMA works)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL              89         81%        2 P0 blockers

================================================================================
NEXT STEPS: CONTRACT PRIORITY ROADMAP
================================================================================

WEEK 1 â€” P0 Blocker 1: special-tokens-registry-v1.yaml
â”œâ”€ Create YAML with Qwen2, Qwen3, LLaMA, Mistral, Phi entries
â”œâ”€ Add falsification tests: token_id < vocab_size
â”œâ”€ Generate Rust bindings: src/format/converter/special_tokens_contract.rs
â””â”€ Integrate: format/converter/tokenizer_loader.rs uses registry

WEEK 2 â€” P0 Blocker 2: model-metadata-bounds-v1.yaml
â”œâ”€ Create YAML with plausibility bounds
â”œâ”€ Add falsification tests for each bound
â”œâ”€ Generate Kani harnesses: cargo +nightly kani
â””â”€ Integrate: format/converter/gguf_import.rs uses bounds

WEEK 3 â€” P0 Blocker 3: tokenizer-vocab-v1.yaml
â”œâ”€ Create YAML with per-model vocab + merge rules
â”œâ”€ Add proptest for merge frequency monotonicity
â”œâ”€ Generate Rust bindings
â””â”€ Integrate: text/bpe/mod.rs validation

WEEK 4 â€” P1 Quality: chat-template-semantics-v1.yaml
â”œâ”€ Formalize 6+ template formats
â”œâ”€ Add grammar + proof obligations
â””â”€ Replace heuristic detection in chat_template/mod.rs

WEEK 5 â€” P1 Quality: tensor-inventory-v1.yaml expansion
â”œâ”€ Add Qwen, Mistral, Phi naming sections
â””â”€ Update format/converter/mod.rs tensor mapping

WEEK 6 â€” P1 Quality: format-parity-v1.yaml expansion
â”œâ”€ Add transposition proof + quantization equivalence
â””â”€ Verify format conversion (GGUF â†’ SafeTensors â†’ APR)

================================================================================
COMMAND REFERENCE
================================================================================

# Validate a contract
pv validate contracts/special-tokens-registry-v1.yaml

# Generate Rust trait + test scaffolding
pv generate-scaffold contracts/special-tokens-registry-v1.yaml \
  --output src/special_tokens_contract.rs

# Generate property tests
pv generate-tests contracts/special-tokens-registry-v1.yaml \
  --output src/tests/special_tokens_contract_tests.rs

# Generate Kani harnesses
pv generate-kani contracts/model-metadata-bounds-v1.yaml \
  --output src/contracts/kani_harnesses.rs

# Audit: verify chain from paper â†’ equation â†’ test â†’ code
pv audit contracts/special-tokens-registry-v1.yaml --binding

================================================================================
REFERENCES
================================================================================

Provable Contracts Directory:
  /home/noah/src/provable-contracts/

Key Files:
  contracts/aprender/binding.yaml          â€” 284 kernelâ†”function bindings
  contracts/model-config-algebra-v1.yaml   â€” 5-level proof hierarchy
  contracts/arch-constraints-v1.yaml       â€” Per-architecture rules
  contracts/aprender/tensor-layout-v1.yaml â€” ROW-MAJOR enforcement

Analysis Document:
  /home/noah/src/aprender/PROVABLE_CONTRACTS_ANALYSIS.md

Commitment:
  All new models MUST have contracts before publishing
  No hardcoded values without YAML contract source

