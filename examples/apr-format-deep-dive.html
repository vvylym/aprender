<!DOCTYPE HTML>
<html lang="en" class="rust" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The .apr Format: A Five Whys Deep Dive - EXTREME TDD - The Aprender Guide to Zero-Defect Machine Learning</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="A comprehensive guide to EXTREME TDD methodology: RED-GREEN-REFACTOR cycles, mutation testing, and Toyota Way principles demonstrated through ML library development">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('rust')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Core Methodology</li><li class="chapter-item expanded "><a href="../methodology/what-is-extreme-tdd.html"><strong aria-hidden="true">1.</strong> What is EXTREME TDD?</a></li><li class="chapter-item expanded "><a href="../methodology/red-green-refactor.html"><strong aria-hidden="true">2.</strong> The RED-GREEN-REFACTOR Cycle</a></li><li class="chapter-item expanded "><a href="../methodology/test-first-philosophy.html"><strong aria-hidden="true">3.</strong> Test-First Philosophy</a></li><li class="chapter-item expanded "><a href="../methodology/zero-tolerance.html"><strong aria-hidden="true">4.</strong> Zero Tolerance Quality</a></li><li class="chapter-item expanded affix "><li class="part-title">The RED Phase</li><li class="chapter-item expanded "><a href="../red-phase/failing-tests-first.html"><strong aria-hidden="true">5.</strong> Writing Failing Tests First</a></li><li class="chapter-item expanded "><a href="../red-phase/test-categories.html"><strong aria-hidden="true">6.</strong> Test Categories</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../red-phase/unit-tests.html"><strong aria-hidden="true">6.1.</strong> Unit Tests</a></li><li class="chapter-item expanded "><a href="../red-phase/integration-tests.html"><strong aria-hidden="true">6.2.</strong> Integration Tests</a></li><li class="chapter-item expanded "><a href="../red-phase/property-based-tests.html"><strong aria-hidden="true">6.3.</strong> Property-Based Tests</a></li></ol></li><li class="chapter-item expanded "><a href="../red-phase/verification-strategy.html"><strong aria-hidden="true">7.</strong> Verification Strategy</a></li><li class="chapter-item expanded affix "><li class="part-title">The GREEN Phase</li><li class="chapter-item expanded "><a href="../green-phase/minimal-implementation.html"><strong aria-hidden="true">8.</strong> Minimal Implementation</a></li><li class="chapter-item expanded "><a href="../green-phase/making-tests-pass.html"><strong aria-hidden="true">9.</strong> Making Tests Pass</a></li><li class="chapter-item expanded "><a href="../green-phase/avoiding-over-engineering.html"><strong aria-hidden="true">10.</strong> Avoiding Over-Engineering</a></li><li class="chapter-item expanded "><a href="../green-phase/simplest-thing.html"><strong aria-hidden="true">11.</strong> The Simplest Thing That Works</a></li><li class="chapter-item expanded affix "><li class="part-title">The REFACTOR Phase</li><li class="chapter-item expanded "><a href="../refactor-phase/refactoring-with-confidence.html"><strong aria-hidden="true">12.</strong> Refactoring with Confidence</a></li><li class="chapter-item expanded "><a href="../refactor-phase/code-quality.html"><strong aria-hidden="true">13.</strong> Code Quality Improvements</a></li><li class="chapter-item expanded "><a href="../refactor-phase/performance-optimization.html"><strong aria-hidden="true">14.</strong> Performance Optimization</a></li><li class="chapter-item expanded "><a href="../refactor-phase/documentation.html"><strong aria-hidden="true">15.</strong> Documentation</a></li><li class="chapter-item expanded affix "><li class="part-title">Advanced Testing</li><li class="chapter-item expanded "><a href="../advanced-testing/popperian-falsification.html"><strong aria-hidden="true">16.</strong> Popperian Falsification</a></li><li class="chapter-item expanded "><a href="../advanced-testing/property-based-testing.html"><strong aria-hidden="true">17.</strong> Property-Based Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../advanced-testing/proptest-fundamentals.html"><strong aria-hidden="true">17.1.</strong> Proptest Fundamentals</a></li><li class="chapter-item expanded "><a href="../advanced-testing/strategies-generators.html"><strong aria-hidden="true">17.2.</strong> Strategies and Generators</a></li><li class="chapter-item expanded "><a href="../advanced-testing/testing-invariants.html"><strong aria-hidden="true">17.3.</strong> Testing Invariants</a></li></ol></li><li class="chapter-item expanded "><a href="../advanced-testing/mutation-testing.html"><strong aria-hidden="true">18.</strong> Mutation Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../advanced-testing/what-is-mutation-testing.html"><strong aria-hidden="true">18.1.</strong> What is Mutation Testing?</a></li><li class="chapter-item expanded "><a href="../advanced-testing/using-cargo-mutants.html"><strong aria-hidden="true">18.2.</strong> Using cargo-mutants</a></li><li class="chapter-item expanded "><a href="../advanced-testing/mutation-score-targets.html"><strong aria-hidden="true">18.3.</strong> Mutation Score Targets</a></li><li class="chapter-item expanded "><a href="../advanced-testing/killing-mutants.html"><strong aria-hidden="true">18.4.</strong> Killing Mutants</a></li></ol></li><li class="chapter-item expanded "><a href="../advanced-testing/fuzzing.html"><strong aria-hidden="true">19.</strong> Fuzzing</a></li><li class="chapter-item expanded "><a href="../advanced-testing/benchmark-testing.html"><strong aria-hidden="true">20.</strong> Benchmark Testing</a></li><li class="chapter-item expanded affix "><li class="part-title">Quality Gates</li><li class="chapter-item expanded "><a href="../quality-gates/pre-commit-hooks.html"><strong aria-hidden="true">21.</strong> Pre-Commit Hooks</a></li><li class="chapter-item expanded "><a href="../quality-gates/continuous-integration.html"><strong aria-hidden="true">22.</strong> Continuous Integration</a></li><li class="chapter-item expanded "><a href="../quality-gates/code-formatting.html"><strong aria-hidden="true">23.</strong> Code Formatting (rustfmt)</a></li><li class="chapter-item expanded "><a href="../quality-gates/linting-clippy.html"><strong aria-hidden="true">24.</strong> Linting (clippy)</a></li><li class="chapter-item expanded "><a href="../quality-gates/coverage-measurement.html"><strong aria-hidden="true">25.</strong> Coverage Measurement</a></li><li class="chapter-item expanded "><a href="../quality-gates/complexity-analysis.html"><strong aria-hidden="true">26.</strong> Complexity Analysis</a></li><li class="chapter-item expanded "><a href="../quality-gates/tdg-score.html"><strong aria-hidden="true">27.</strong> Technical Debt Gradient (TDG)</a></li><li class="chapter-item expanded affix "><li class="part-title">Toyota Way Principles</li><li class="chapter-item expanded "><a href="../toyota-way/overview.html"><strong aria-hidden="true">28.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../toyota-way/kaizen.html"><strong aria-hidden="true">29.</strong> Kaizen (Continuous Improvement)</a></li><li class="chapter-item expanded "><a href="../toyota-way/genchi-genbutsu.html"><strong aria-hidden="true">30.</strong> Genchi Genbutsu (Go and See)</a></li><li class="chapter-item expanded "><a href="../toyota-way/jidoka.html"><strong aria-hidden="true">31.</strong> Jidoka (Built-in Quality)</a></li><li class="chapter-item expanded "><a href="../toyota-way/pdca-cycle.html"><strong aria-hidden="true">32.</strong> PDCA Cycle</a></li><li class="chapter-item expanded "><a href="../toyota-way/respect-for-people.html"><strong aria-hidden="true">33.</strong> Respect for People</a></li><li class="chapter-item expanded affix "><li class="part-title">Machine Learning Fundamentals</li><li class="chapter-item expanded "><a href="../ml-fundamentals/linear-regression.html"><strong aria-hidden="true">34.</strong> Linear Regression Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/regularization.html"><strong aria-hidden="true">35.</strong> Regularization Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/logistic-regression.html"><strong aria-hidden="true">36.</strong> Logistic Regression Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/knn.html"><strong aria-hidden="true">37.</strong> K-Nearest Neighbors (kNN) Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/naive-bayes.html"><strong aria-hidden="true">38.</strong> Naive Bayes Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/bayesian-inference.html"><strong aria-hidden="true">39.</strong> Bayesian Inference Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/svm.html"><strong aria-hidden="true">40.</strong> Support Vector Machines (SVM) Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/decision-trees.html"><strong aria-hidden="true">41.</strong> Decision Trees Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/ensemble-methods.html"><strong aria-hidden="true">42.</strong> Ensemble Methods Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/kmeans-clustering.html"><strong aria-hidden="true">43.</strong> K-Means Clustering Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/pca.html"><strong aria-hidden="true">44.</strong> Principal Component Analysis (PCA) Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/tsne.html"><strong aria-hidden="true">45.</strong> t-SNE (t-Distributed Stochastic Neighbor Embedding) Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/regression-metrics.html"><strong aria-hidden="true">46.</strong> Regression Metrics Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/classification-metrics.html"><strong aria-hidden="true">47.</strong> Classification Metrics Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/cross-validation.html"><strong aria-hidden="true">48.</strong> Cross-Validation Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/gradient-descent.html"><strong aria-hidden="true">49.</strong> Gradient Descent Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/advanced-optimizers.html"><strong aria-hidden="true">50.</strong> Advanced Optimizers Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/metaheuristics.html"><strong aria-hidden="true">51.</strong> Metaheuristics Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/automl.html"><strong aria-hidden="true">52.</strong> AutoML: Automated Machine Learning</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/compiler-in-the-loop.html"><strong aria-hidden="true">53.</strong> Compiler-in-the-Loop Learning</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/online-learning.html"><strong aria-hidden="true">54.</strong> Online Learning Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/neuro-symbolic.html"><strong aria-hidden="true">55.</strong> Neuro-Symbolic Reasoning Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/transfer-learning.html"><strong aria-hidden="true">56.</strong> Transfer Learning Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/active-learning.html"><strong aria-hidden="true">57.</strong> Active Learning Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/weak-supervision.html"><strong aria-hidden="true">58.</strong> Weak Supervision Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/automatic-differentiation.html"><strong aria-hidden="true">59.</strong> Automatic Differentiation Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/graph-neural-networks.html"><strong aria-hidden="true">60.</strong> Graph Neural Networks Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/neural-network-pruning.html"><strong aria-hidden="true">61.</strong> Neural Network Pruning Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/lottery-ticket-hypothesis.html"><strong aria-hidden="true">62.</strong> Lottery Ticket Hypothesis Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/monte-carlo.html"><strong aria-hidden="true">63.</strong> Monte Carlo Simulation Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/speech-voice-processing.html"><strong aria-hidden="true">64.</strong> Speech and Voice Processing Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/probability-calibration.html"><strong aria-hidden="true">65.</strong> Probability Calibration Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/chaos-engineering.html"><strong aria-hidden="true">66.</strong> Chaos Engineering for ML</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/webassembly-ml.html"><strong aria-hidden="true">67.</strong> WebAssembly for ML</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/feature-scaling.html"><strong aria-hidden="true">68.</strong> Feature Scaling Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/audio-processing.html"><strong aria-hidden="true">69.</strong> Audio Processing Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/graph-algorithms.html"><strong aria-hidden="true">70.</strong> Graph Algorithms Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/graph-pathfinding.html"><strong aria-hidden="true">71.</strong> Graph Pathfinding Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/graph-components-traversal.html"><strong aria-hidden="true">72.</strong> Graph Components and Traversal</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/graph-link-prediction.html"><strong aria-hidden="true">73.</strong> Graph Link Prediction and Community Detection</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/descriptive-statistics.html"><strong aria-hidden="true">74.</strong> Descriptive Statistics Theory</a></li><li class="chapter-item expanded "><a href="../ml-fundamentals/apriori.html"><strong aria-hidden="true">75.</strong> Apriori Algorithm Theory</a></li><li class="chapter-item expanded affix "><li class="part-title">Real-World Examples from Aprender</li><li class="chapter-item expanded "><a href="../examples/examples-reference.html"><strong aria-hidden="true">76.</strong> Examples Reference</a></li><li class="chapter-item expanded "><a href="../examples/linear-regression.html"><strong aria-hidden="true">77.</strong> Case Study: Linear Regression</a></li><li class="chapter-item expanded "><a href="../examples/boston-housing.html"><strong aria-hidden="true">78.</strong> Case Study: Boston Housing</a></li><li class="chapter-item expanded "><a href="../examples/cross-validation.html"><strong aria-hidden="true">79.</strong> Case Study: Cross-Validation</a></li><li class="chapter-item expanded "><a href="../examples/grid-search-tuning.html"><strong aria-hidden="true">80.</strong> Case Study: Grid Search Hyperparameter Tuning</a></li><li class="chapter-item expanded "><a href="../examples/automl-clustering.html"><strong aria-hidden="true">81.</strong> Case Study: AutoML Clustering (TPE)</a></li><li class="chapter-item expanded "><a href="../examples/random-forest.html"><strong aria-hidden="true">82.</strong> Case Study: Random Forest</a></li><li class="chapter-item expanded "><a href="../examples/random-forest-iris.html"><strong aria-hidden="true">83.</strong> Case Study: Random Forest Iris</a></li><li class="chapter-item expanded "><a href="../examples/random-forest-regression.html"><strong aria-hidden="true">84.</strong> Case Study: Random Forest Regression</a></li><li class="chapter-item expanded "><a href="../examples/decision-tree-iris.html"><strong aria-hidden="true">85.</strong> Case Study: Decision Tree Iris</a></li><li class="chapter-item expanded "><a href="../examples/decision-tree-regression.html"><strong aria-hidden="true">86.</strong> Case Study: Decision Tree Regression</a></li><li class="chapter-item expanded "><a href="../examples/model-serialization.html"><strong aria-hidden="true">87.</strong> Case Study: Model Serialization</a></li><li class="chapter-item expanded "><a href="../examples/model-format.html"><strong aria-hidden="true">88.</strong> Case Study: Model Format (.apr)</a></li><li class="chapter-item expanded "><a href="../examples/apr-format-deep-dive.html" class="active"><strong aria-hidden="true">89.</strong> The .apr Format: A Five Whys Deep Dive</a></li><li class="chapter-item expanded "><a href="../examples/model-bundling-paging.html"><strong aria-hidden="true">90.</strong> Case Study: Model Bundling and Memory Paging</a></li><li class="chapter-item expanded "><a href="../examples/tracing-memory-paging.html"><strong aria-hidden="true">91.</strong> Case Study: Tracing Memory Paging with Renacer</a></li><li class="chapter-item expanded "><a href="../examples/bundle-trace-demo.html"><strong aria-hidden="true">92.</strong> Case Study: Bundle Trace Demo</a></li><li class="chapter-item expanded "><a href="../examples/synthetic-data-generation.html"><strong aria-hidden="true">93.</strong> Case Study: Synthetic Data Generation</a></li><li class="chapter-item expanded "><a href="../examples/code-eda.html"><strong aria-hidden="true">94.</strong> Case Study: Code-Aware EDA</a></li><li class="chapter-item expanded "><a href="../examples/code-feature-extractor.html"><strong aria-hidden="true">95.</strong> Case Study: Code Feature Extraction</a></li><li class="chapter-item expanded "><a href="../examples/code-analysis.html"><strong aria-hidden="true">96.</strong> Case Study: Code Analysis with Code2Vec and MPNN</a></li><li class="chapter-item expanded "><a href="../examples/kmeans-clustering.html"><strong aria-hidden="true">97.</strong> Case Study: KMeans Clustering</a></li><li class="chapter-item expanded "><a href="../examples/dbscan-clustering.html"><strong aria-hidden="true">98.</strong> Case Study: DBSCAN Clustering</a></li><li class="chapter-item expanded "><a href="../examples/hierarchical-clustering.html"><strong aria-hidden="true">99.</strong> Case Study: Hierarchical Clustering</a></li><li class="chapter-item expanded "><a href="../examples/gmm-clustering.html"><strong aria-hidden="true">100.</strong> Case Study: GMM Clustering</a></li><li class="chapter-item expanded "><a href="../examples/iris-clustering.html"><strong aria-hidden="true">101.</strong> Case Study: Iris Clustering</a></li><li class="chapter-item expanded "><a href="../examples/logistic-regression.html"><strong aria-hidden="true">102.</strong> Case Study: Logistic Regression</a></li><li class="chapter-item expanded "><a href="../examples/knn-iris.html"><strong aria-hidden="true">103.</strong> Case Study: KNN Iris</a></li><li class="chapter-item expanded "><a href="../examples/naive-bayes-iris.html"><strong aria-hidden="true">104.</strong> Case Study: Naive Bayes Iris</a></li><li class="chapter-item expanded "><a href="../examples/beta-binomial-inference.html"><strong aria-hidden="true">105.</strong> Case Study: Beta-Binomial Bayesian Inference</a></li><li class="chapter-item expanded "><a href="../examples/gamma-poisson-inference.html"><strong aria-hidden="true">106.</strong> Case Study: Gamma-Poisson Bayesian Inference</a></li><li class="chapter-item expanded "><a href="../examples/normal-inverse-gamma-inference.html"><strong aria-hidden="true">107.</strong> Case Study: Normal-InverseGamma Bayesian Inference</a></li><li class="chapter-item expanded "><a href="../examples/dirichlet-multinomial-inference.html"><strong aria-hidden="true">108.</strong> Case Study: Dirichlet-Multinomial Bayesian Inference</a></li><li class="chapter-item expanded "><a href="../examples/bayesian-linear-regression.html"><strong aria-hidden="true">109.</strong> Case Study: Bayesian Linear Regression</a></li><li class="chapter-item expanded "><a href="../examples/bayesian-logistic-regression.html"><strong aria-hidden="true">110.</strong> Case Study: Bayesian Logistic Regression</a></li><li class="chapter-item expanded "><a href="../examples/negative-binomial-glm.html"><strong aria-hidden="true">111.</strong> Case Study: Negative Binomial GLM (Overdispersed Counts)</a></li><li class="chapter-item expanded "><a href="../examples/svm-iris.html"><strong aria-hidden="true">112.</strong> Case Study: SVM Iris</a></li><li class="chapter-item expanded "><a href="../examples/gbm-iris.html"><strong aria-hidden="true">113.</strong> Case Study: Gradient Boosting Iris</a></li><li class="chapter-item expanded "><a href="../examples/regularized-regression.html"><strong aria-hidden="true">114.</strong> Case Study: Regularized Regression</a></li><li class="chapter-item expanded "><a href="../examples/optimizer-demo.html"><strong aria-hidden="true">115.</strong> Case Study: Optimizer Demo</a></li><li class="chapter-item expanded "><a href="../examples/batch-optimization.html"><strong aria-hidden="true">116.</strong> Case Study: Batch Optimization</a></li><li class="chapter-item expanded "><a href="../examples/convex-optimization.html"><strong aria-hidden="true">117.</strong> Case Study: Convex Optimization (FISTA + Coordinate Descent)</a></li><li class="chapter-item expanded "><a href="../examples/constrained-optimization.html"><strong aria-hidden="true">118.</strong> Case Study: Constrained Optimization (Projected GD + Augmented Lagrangian + Interior Point)</a></li><li class="chapter-item expanded "><a href="../examples/admm-optimization.html"><strong aria-hidden="true">119.</strong> Case Study: ADMM Optimization (Distributed ML + Federated Learning)</a></li><li class="chapter-item expanded "><a href="../examples/differential-evolution.html"><strong aria-hidden="true">120.</strong> Case Study: Differential Evolution (Metaheuristics)</a></li><li class="chapter-item expanded "><a href="../examples/metaheuristics-optimization.html"><strong aria-hidden="true">121.</strong> Case Study: Metaheuristics Optimization</a></li><li class="chapter-item expanded "><a href="../examples/aco-tsp.html"><strong aria-hidden="true">122.</strong> Case Study: Ant Colony Optimization (TSP)</a></li><li class="chapter-item expanded "><a href="../examples/tabu-tsp.html"><strong aria-hidden="true">123.</strong> Case Study: Tabu Search (TSP)</a></li><li class="chapter-item expanded "><a href="../examples/tsp-solver-crate.html"><strong aria-hidden="true">124.</strong> Case Study: aprender-tsp Sub-Crate</a></li><li class="chapter-item expanded "><a href="../examples/predator-prey-optimization.html"><strong aria-hidden="true">125.</strong> Case Study: Predator-Prey Optimization</a></li><li class="chapter-item expanded "><a href="../examples/dataframe-basics.html"><strong aria-hidden="true">126.</strong> Case Study: DataFrame Basics</a></li><li class="chapter-item expanded "><a href="../examples/data-preprocessing-scalers.html"><strong aria-hidden="true">127.</strong> Case Study: Data Preprocessing with Scalers</a></li><li class="chapter-item expanded "><a href="../examples/graph-social-network.html"><strong aria-hidden="true">128.</strong> Case Study: Graph Social Network</a></li><li class="chapter-item expanded "><a href="../examples/community-detection.html"><strong aria-hidden="true">129.</strong> Case Study: Community Detection with Louvain</a></li><li class="chapter-item expanded "><a href="../examples/graph-algorithms-comprehensive.html"><strong aria-hidden="true">130.</strong> Case Study: Comprehensive Graph Algorithms</a></li><li class="chapter-item expanded "><a href="../examples/descriptive-statistics.html"><strong aria-hidden="true">131.</strong> Case Study: Descriptive Statistics</a></li><li class="chapter-item expanded "><a href="../examples/bayesian-blocks-histogram.html"><strong aria-hidden="true">132.</strong> Case Study: Bayesian Blocks Histogram</a></li><li class="chapter-item expanded "><a href="../examples/pca-iris.html"><strong aria-hidden="true">133.</strong> Case Study: PCA Iris</a></li><li class="chapter-item expanded "><a href="../examples/isolation-forest-anomaly.html"><strong aria-hidden="true">134.</strong> Case Study: Isolation Forest Anomaly Detection</a></li><li class="chapter-item expanded "><a href="../examples/lof-anomaly.html"><strong aria-hidden="true">135.</strong> Case Study: Local Outlier Factor (LOF)</a></li><li class="chapter-item expanded "><a href="../examples/spectral-clustering.html"><strong aria-hidden="true">136.</strong> Case Study: Spectral Clustering</a></li><li class="chapter-item expanded "><a href="../examples/tsne-visualization.html"><strong aria-hidden="true">137.</strong> Case Study: t-SNE Visualization</a></li><li class="chapter-item expanded "><a href="../examples/market-basket-apriori.html"><strong aria-hidden="true">138.</strong> Case Study: Market Basket Analysis (Apriori)</a></li><li class="chapter-item expanded "><a href="../examples/time-series-forecasting.html"><strong aria-hidden="true">139.</strong> Case Study: ARIMA Time Series Forecasting</a></li><li class="chapter-item expanded "><a href="../examples/text-preprocessing.html"><strong aria-hidden="true">140.</strong> Case Study: Text Preprocessing for NLP</a></li><li class="chapter-item expanded "><a href="../examples/text-classification.html"><strong aria-hidden="true">141.</strong> Case Study: Text Classification with TF-IDF</a></li><li class="chapter-item expanded "><a href="../examples/chat-template.html"><strong aria-hidden="true">142.</strong> Case Study: Chat Templates for LLM Inference</a></li><li class="chapter-item expanded "><a href="../examples/advanced-nlp.html"><strong aria-hidden="true">143.</strong> Case Study: Advanced NLP (Similarity, Entities, Summarization)</a></li><li class="chapter-item expanded "><a href="../examples/xor-neural-network.html"><strong aria-hidden="true">144.</strong> Case Study: XOR Neural Network (Deep Learning)</a></li><li class="chapter-item expanded "><a href="../examples/xor-training.html"><strong aria-hidden="true">145.</strong> Case Study: XOR Training</a></li><li class="chapter-item expanded "><a href="../examples/neural-network-training.html"><strong aria-hidden="true">146.</strong> Case Study: Neural Network Training Pipeline</a></li><li class="chapter-item expanded "><a href="../examples/classification-training.html"><strong aria-hidden="true">147.</strong> Case Study: Classification Training</a></li><li class="chapter-item expanded "><a href="../examples/nlp-advanced.html"><strong aria-hidden="true">148.</strong> Case Study: Advanced NLP</a></li><li class="chapter-item expanded "><a href="../examples/topic-sentiment-analysis.html"><strong aria-hidden="true">149.</strong> Case Study: Topic & Sentiment Analysis</a></li><li class="chapter-item expanded "><a href="../examples/recommend-content.html"><strong aria-hidden="true">150.</strong> Case Study: Content-Based Recommendations</a></li><li class="chapter-item expanded "><a href="../examples/content-recommender.html"><strong aria-hidden="true">151.</strong> Case Study: Content-Based Recommender System</a></li><li class="chapter-item expanded "><a href="../examples/shell-completion.html"><strong aria-hidden="true">152.</strong> Case Study: AI Shell Completion</a></li><li class="chapter-item expanded "><a href="../examples/shell-completion-benchmarks.html"><strong aria-hidden="true">153.</strong> Case Study: Shell Completion Benchmarks</a></li><li class="chapter-item expanded "><a href="../examples/shell-hf-hub-publishing.html"><strong aria-hidden="true">154.</strong> Case Study: Publishing Shell Models to HF Hub</a></li><li class="chapter-item expanded "><a href="../examples/shell-encryption-tiers.html"><strong aria-hidden="true">155.</strong> Case Study: Model Encryption Tiers</a></li><li class="chapter-item expanded "><a href="../examples/shell-encryption-demo.html"><strong aria-hidden="true">156.</strong> Case Study: Shell Encryption Demo</a></li><li class="chapter-item expanded "><a href="../examples/shell-homomorphic-encryption.html"><strong aria-hidden="true">157.</strong> Case Study: Shell Homomorphic Encryption</a></li><li class="chapter-item expanded "><a href="../examples/shell-model-format.html"><strong aria-hidden="true">158.</strong> Case Study: Shell Model Format</a></li><li class="chapter-item expanded "><a href="../examples/mixture-of-experts.html"><strong aria-hidden="true">159.</strong> Case Study: Mixture of Experts (MoE)</a></li><li class="chapter-item expanded "><a href="../examples/shell-history-developer-guide.html"><strong aria-hidden="true">160.</strong> Developer's Guide: Shell History Models</a></li><li class="chapter-item expanded "><a href="../examples/custom-error-classifier.html"><strong aria-hidden="true">161.</strong> Building Custom Error Classifiers</a></li><li class="chapter-item expanded "><a href="../examples/citl-automated-repair.html"><strong aria-hidden="true">162.</strong> Case Study: CITL Automated Program Repair</a></li><li class="chapter-item expanded "><a href="../examples/batuta-integration.html"><strong aria-hidden="true">163.</strong> Case Study: Batuta - Automated Migration to Aprender</a></li><li class="chapter-item expanded "><a href="../examples/online-learning.html"><strong aria-hidden="true">164.</strong> Case Study: Online Learning and Dynamic Retraining</a></li><li class="chapter-item expanded "><a href="../examples/apr-loading-modes.html"><strong aria-hidden="true">165.</strong> Case Study: APR Loading Modes</a></li><li class="chapter-item expanded "><a href="../examples/apr-inspection.html"><strong aria-hidden="true">166.</strong> Case Study: APR Model Inspection</a></li><li class="chapter-item expanded "><a href="../examples/apr-scoring.html"><strong aria-hidden="true">167.</strong> Case Study: APR 100-Point Quality Scoring</a></li><li class="chapter-item expanded "><a href="../examples/poka-yoke-validation.html"><strong aria-hidden="true">168.</strong> Case Study: APR Poka-Yoke Validation</a></li><li class="chapter-item expanded "><a href="../examples/apr-cache.html"><strong aria-hidden="true">169.</strong> Case Study: APR Model Cache</a></li><li class="chapter-item expanded "><a href="../examples/apr-embed.html"><strong aria-hidden="true">170.</strong> Case Study: APR Data Embedding</a></li><li class="chapter-item expanded "><a href="../examples/apr-with-metadata.html"><strong aria-hidden="true">171.</strong> Case Study: APR with JSON Metadata</a></li><li class="chapter-item expanded "><a href="../examples/cuda-backend.html"><strong aria-hidden="true">172.</strong> Case Study: CUDA and GPU Backends</a></li><li class="chapter-item expanded "><a href="../examples/trueno-compute-integration.html"><strong aria-hidden="true">173.</strong> Case Study: Trueno Compute Integration</a></li><li class="chapter-item expanded "><a href="../examples/apr-cli-demo.html"><strong aria-hidden="true">174.</strong> Case Study: APR CLI Tool Demo</a></li><li class="chapter-item expanded "><a href="../examples/create-test-apr.html"><strong aria-hidden="true">175.</strong> Case Study: Create Test APR Files</a></li><li class="chapter-item expanded "><a href="../examples/apr-cli-commands.html"><strong aria-hidden="true">176.</strong> Case Study: APR CLI Commands Demo</a></li><li class="chapter-item expanded "><a href="../examples/model-zoo.html"><strong aria-hidden="true">177.</strong> Case Study: Model Zoo</a></li><li class="chapter-item expanded "><a href="../examples/sovereign-stack.html"><strong aria-hidden="true">178.</strong> Case Study: Sovereign AI Stack Integration</a></li><li class="chapter-item expanded "><a href="../examples/sovereign-offline.html"><strong aria-hidden="true">179.</strong> Case Study: Sovereign AI Offline Mode</a></li><li class="chapter-item expanded "><a href="../examples/explainability-audit.html"><strong aria-hidden="true">180.</strong> Case Study: Model Explainability and Audit Trails</a></li><li class="chapter-item expanded "><a href="../examples/model-serving.html"><strong aria-hidden="true">181.</strong> Case Study: Model Serving</a></li><li class="chapter-item expanded "><a href="../examples/federation-gateway.html"><strong aria-hidden="true">182.</strong> Case Study: Federation Gateway</a></li><li class="chapter-item expanded "><a href="../examples/federation-routing.html"><strong aria-hidden="true">183.</strong> Case Study: Federation Routing Policies</a></li><li class="chapter-item expanded "><a href="../examples/probar-tui-testing.html"><strong aria-hidden="true">184.</strong> Case Study: Probar TUI Testing</a></li><li class="chapter-item expanded "><a href="../examples/pipeline-verification.html"><strong aria-hidden="true">185.</strong> Case Study: Pipeline Verification</a></li><li class="chapter-item expanded "><a href="../examples/state-machine-playbooks.html"><strong aria-hidden="true">186.</strong> Case Study: State Machine Playbooks</a></li><li class="chapter-item expanded "><a href="../examples/tensorlogic-reasoning.html"><strong aria-hidden="true">187.</strong> Case Study: TensorLogic Neuro-Symbolic Reasoning</a></li><li class="chapter-item expanded "><a href="../examples/audio-mel-spectrogram.html"><strong aria-hidden="true">188.</strong> Case Study: Audio Mel Spectrogram Processing</a></li><li class="chapter-item expanded "><a href="../examples/monte-carlo-simulation.html"><strong aria-hidden="true">189.</strong> Case Study: Monte Carlo Financial Simulation</a></li><li class="chapter-item expanded "><a href="../examples/autograd-training.html"><strong aria-hidden="true">190.</strong> Case Study: Automatic Differentiation Training</a></li><li class="chapter-item expanded "><a href="../examples/gnn-node-classification.html"><strong aria-hidden="true">191.</strong> Case Study: Graph Neural Networks</a></li><li class="chapter-item expanded "><a href="../examples/pruning-magnitude.html"><strong aria-hidden="true">192.</strong> Case Study: Magnitude Pruning</a></li><li class="chapter-item expanded "><a href="../examples/lottery-ticket-pruning.html"><strong aria-hidden="true">193.</strong> Case Study: Lottery Ticket Pruning</a></li><li class="chapter-item expanded "><a href="../examples/bench-comparison.html"><strong aria-hidden="true">194.</strong> Case Study: Benchmark Comparison</a></li><li class="chapter-item expanded "><a href="../examples/showcase-benchmark.html"><strong aria-hidden="true">195.</strong> Case Study: Showcase Benchmark</a></li><li class="chapter-item expanded "><a href="../examples/qa-falsification.html"><strong aria-hidden="true">196.</strong> Case Study: QA Falsification Protocol</a></li><li class="chapter-item expanded "><a href="../examples/qwen-qa-playbook.html"><strong aria-hidden="true">197.</strong> Case Study: Qwen2.5-Coder QA Playbook</a></li><li class="chapter-item expanded "><a href="../examples/ptx-parity-validation.html"><strong aria-hidden="true">198.</strong> Case Study: PTX Parity Validation (GH-219)</a></li><li class="chapter-item expanded "><a href="../examples/hex-forensics.html"><strong aria-hidden="true">199.</strong> Case Study: Hex Forensics — Binary Model Inspection</a></li><li class="chapter-item expanded "><a href="../examples/rosetta-stone.html"><strong aria-hidden="true">200.</strong> Case Study: Rosetta Stone — Universal Format Converter</a></li><li class="chapter-item expanded "><a href="../examples/validated-tensors.html"><strong aria-hidden="true">201.</strong> Case Study: Validated Tensors — Compile-Time Contracts</a></li><li class="chapter-item expanded "><a href="../examples/qwen-inference.html"><strong aria-hidden="true">202.</strong> Case Study: Qwen Inference with realizar</a></li><li class="chapter-item expanded "><a href="../examples/sharded-safetensors-serve.html"><strong aria-hidden="true">203.</strong> Case Study: Sharded SafeTensors Serving (GH-213)</a></li><li class="chapter-item expanded "><a href="../examples/model-merge-strategies.html"><strong aria-hidden="true">204.</strong> Case Study: Model Merge Strategies (GH-245)</a></li><li class="chapter-item expanded affix "><li class="part-title">Sprint-Based Development</li><li class="chapter-item expanded "><a href="../sprints/sprint-planning.html"><strong aria-hidden="true">205.</strong> Sprint Planning</a></li><li class="chapter-item expanded "><a href="../sprints/sprint-execution.html"><strong aria-hidden="true">206.</strong> Sprint Execution</a></li><li class="chapter-item expanded "><a href="../sprints/sprint-review.html"><strong aria-hidden="true">207.</strong> Sprint Review</a></li><li class="chapter-item expanded "><a href="../sprints/sprint-retrospective.html"><strong aria-hidden="true">208.</strong> Sprint Retrospective</a></li><li class="chapter-item expanded "><a href="../sprints/issue-management.html"><strong aria-hidden="true">209.</strong> Issue Management</a></li><li class="chapter-item expanded affix "><li class="part-title">Anti-Hallucination Enforcement</li><li class="chapter-item expanded "><a href="../anti-hallucination/test-backed-examples.html"><strong aria-hidden="true">210.</strong> Test-Backed Examples</a></li><li class="chapter-item expanded "><a href="../anti-hallucination/example-verification.html"><strong aria-hidden="true">211.</strong> Example Verification</a></li><li class="chapter-item expanded "><a href="../anti-hallucination/ci-validation.html"><strong aria-hidden="true">212.</strong> CI Validation</a></li><li class="chapter-item expanded "><a href="../anti-hallucination/documentation-testing.html"><strong aria-hidden="true">213.</strong> Documentation Testing</a></li><li class="chapter-item expanded affix "><li class="part-title">Tools and Setup</li><li class="chapter-item expanded "><a href="../tools/development-environment.html"><strong aria-hidden="true">214.</strong> Development Environment</a></li><li class="chapter-item expanded "><a href="../tools/cargo-test.html"><strong aria-hidden="true">215.</strong> cargo test</a></li><li class="chapter-item expanded "><a href="../tools/cargo-clippy.html"><strong aria-hidden="true">216.</strong> cargo clippy</a></li><li class="chapter-item expanded "><a href="../tools/cargo-fmt.html"><strong aria-hidden="true">217.</strong> cargo fmt</a></li><li class="chapter-item expanded "><a href="../tools/cargo-mutants.html"><strong aria-hidden="true">218.</strong> cargo mutants</a></li><li class="chapter-item expanded "><a href="../tools/proptest.html"><strong aria-hidden="true">219.</strong> proptest</a></li><li class="chapter-item expanded "><a href="../tools/criterion.html"><strong aria-hidden="true">220.</strong> criterion</a></li><li class="chapter-item expanded "><a href="../tools/pmat.html"><strong aria-hidden="true">221.</strong> pmat (Toyota AI Toolkit)</a></li><li class="chapter-item expanded "><a href="../tools/apr-cli.html"><strong aria-hidden="true">222.</strong> apr (APR Model Operations CLI)</a></li><li class="chapter-item expanded "><a href="../tools/apr-spec.html"><strong aria-hidden="true">223.</strong> APR Format Specification</a></li><li class="chapter-item expanded affix "><li class="part-title">Best Practices</li><li class="chapter-item expanded "><a href="../best-practices/error-handling.html"><strong aria-hidden="true">224.</strong> Error Handling</a></li><li class="chapter-item expanded "><a href="../best-practices/api-design.html"><strong aria-hidden="true">225.</strong> API Design</a></li><li class="chapter-item expanded "><a href="../best-practices/builder-pattern.html"><strong aria-hidden="true">226.</strong> Builder Pattern</a></li><li class="chapter-item expanded "><a href="../best-practices/type-safety.html"><strong aria-hidden="true">227.</strong> Type Safety</a></li><li class="chapter-item expanded "><a href="../best-practices/performance.html"><strong aria-hidden="true">228.</strong> Performance Considerations</a></li><li class="chapter-item expanded "><a href="../best-practices/documentation-standards.html"><strong aria-hidden="true">229.</strong> Documentation Standards</a></li><li class="chapter-item expanded affix "><li class="part-title">Metrics and Measurement</li><li class="chapter-item expanded "><a href="../metrics/test-coverage.html"><strong aria-hidden="true">230.</strong> Test Coverage</a></li><li class="chapter-item expanded "><a href="../metrics/mutation-score.html"><strong aria-hidden="true">231.</strong> Mutation Score</a></li><li class="chapter-item expanded "><a href="../metrics/cyclomatic-complexity.html"><strong aria-hidden="true">232.</strong> Cyclomatic Complexity</a></li><li class="chapter-item expanded "><a href="../metrics/code-churn.html"><strong aria-hidden="true">233.</strong> Code Churn</a></li><li class="chapter-item expanded "><a href="../metrics/build-times.html"><strong aria-hidden="true">234.</strong> Build Times</a></li><li class="chapter-item expanded "><a href="../metrics/tdg-breakdown.html"><strong aria-hidden="true">235.</strong> TDG Score Breakdown</a></li><li class="chapter-item expanded affix "><li class="part-title">Common Pitfalls</li><li class="chapter-item expanded "><a href="../pitfalls/skipping-tests.html"><strong aria-hidden="true">236.</strong> Skipping Tests</a></li><li class="chapter-item expanded "><a href="../pitfalls/insufficient-coverage.html"><strong aria-hidden="true">237.</strong> Insufficient Test Coverage</a></li><li class="chapter-item expanded "><a href="../pitfalls/ignoring-warnings.html"><strong aria-hidden="true">238.</strong> Ignoring Warnings</a></li><li class="chapter-item expanded "><a href="../pitfalls/over-mocking.html"><strong aria-hidden="true">239.</strong> Over-Mocking</a></li><li class="chapter-item expanded "><a href="../pitfalls/flaky-tests.html"><strong aria-hidden="true">240.</strong> Flaky Tests</a></li><li class="chapter-item expanded "><a href="../pitfalls/technical-debt.html"><strong aria-hidden="true">241.</strong> Technical Debt Accumulation</a></li><li class="chapter-item expanded affix "><li class="part-title">Appendix</li><li class="chapter-item expanded "><a href="../appendix/glossary.html"><strong aria-hidden="true">242.</strong> Glossary</a></li><li class="chapter-item expanded "><a href="../appendix/references.html"><strong aria-hidden="true">243.</strong> References</a></li><li class="chapter-item expanded "><a href="../appendix/further-reading.html"><strong aria-hidden="true">244.</strong> Further Reading</a></li><li class="chapter-item expanded "><a href="../appendix/contributing.html"><strong aria-hidden="true">245.</strong> Contributing to This Book</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">EXTREME TDD - The Aprender Guide to Zero-Defect Machine Learning</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/paiml/aprender" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/paiml/aprender/edit/main/book/src/examples/apr-format-deep-dive.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-apr-format-a-five-whys-deep-dive"><a class="header" href="#the-apr-format-a-five-whys-deep-dive">The .apr Format: A Five Whys Deep Dive</a></h1>
<p>Why does aprender use its own model format instead of GGUF, SafeTensors, or ONNX? This chapter applies Toyota's <strong>Five Whys</strong> methodology to explain every design decision and preemptively address skepticism.</p>
<h2 id="executive-summary"><a class="header" href="#executive-summary">Executive Summary</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Feature</th><th>.apr</th><th>GGUF</th><th>SafeTensors</th><th>ONNX</th></tr></thead><tbody>
<tr><td>Pure Rust</td><td><strong>Yes</strong></td><td>No (C/C++)</td><td>Partial</td><td>No (C++)</td></tr>
<tr><td>WASM</td><td><strong>Native</strong></td><td>No</td><td>Limited</td><td>No</td></tr>
<tr><td>Single Binary Embed</td><td><strong>Yes</strong></td><td>No</td><td>No</td><td>No</td></tr>
<tr><td>Encryption</td><td><strong>AES-256-GCM</strong></td><td>No</td><td>No</td><td>No</td></tr>
<tr><td>ARM/Embedded</td><td><strong>Native</strong></td><td>Requires porting</td><td>Limited</td><td>Requires runtime</td></tr>
<tr><td>trueno SIMD</td><td><strong>Native</strong></td><td>N/A</td><td>N/A</td><td>N/A</td></tr>
<tr><td>File Size Overhead</td><td><strong>32 bytes</strong></td><td>~1KB</td><td>~100 bytes</td><td>~10KB</td></tr>
</tbody></table>
</div>
<h2 id="the-five-whys-why-not-just-use-gguf"><a class="header" href="#the-five-whys-why-not-just-use-gguf">The Five Whys: Why Not Just Use GGUF?</a></h2>
<h3 id="why-1-why-create-a-new-format-at-all"><a class="header" href="#why-1-why-create-a-new-format-at-all">Why #1: Why create a new format at all?</a></h3>
<p><strong>Skeptic:</strong> &quot;GGUF is the industry standard for LLMs. Why reinvent the wheel?&quot;</p>
<p><strong>Answer:</strong> GGUF solves a different problem. It's optimized for <em>loading pre-trained LLMs into llama.cpp</em>. We need a format optimized for:</p>
<ul>
<li>Training and saving <em>any</em> ML model type (not just transformers)</li>
<li>Deploying to browsers, embedded devices, and serverless</li>
<li>Zero C/C++ dependencies (security, portability)</li>
</ul>
<pre><code class="language-rust ignore">// GGUF requires: C compiler, platform-specific builds
// .apr requires: Nothing. Pure Rust.

use aprender::format::{save, load, ModelType};

// Works identically on x86_64, ARM, WASM
let model = train_model(&amp;data)?;
save(&amp;model, ModelType::RandomForest, &quot;model.apr&quot;, Default::default())?;</code></pre>
<h3 id="why-2-why-does-pure-rust-matter"><a class="header" href="#why-2-why-does-pure-rust-matter">Why #2: Why does &quot;Pure Rust&quot; matter?</a></h3>
<p><strong>Skeptic:</strong> &quot;C/C++ is fast. Who cares about purity?&quot;</p>
<p><strong>Answer:</strong> Because C/C++ dependencies cause these real problems:</p>
<div class="table-wrapper"><table><thead><tr><th>Problem</th><th>Impact</th><th>.apr Solution</th></tr></thead><tbody>
<tr><td>Cross-compilation</td><td>Can't easily build ARM from x86</td><td><code>cargo build --target aarch64</code> just works</td></tr>
<tr><td>WASM</td><td>C libraries don't compile to WASM</td><td>Pure Rust compiles to wasm32</td></tr>
<tr><td>Security audits</td><td>C code requires separate tooling</td><td><code>cargo audit</code> covers everything</td></tr>
<tr><td>Supply chain</td><td>C deps have separate CVE tracking</td><td>Single Rust dependency tree</td></tr>
<tr><td>Reproducibility</td><td>C builds vary by system</td><td>Cargo lockfile guarantees reproducibility</td></tr>
</tbody></table>
</div>
<p><strong>Real example:</strong> Try deploying llama.cpp to AWS Lambda ARM64. Now try:</p>
<pre><code class="language-bash"># .apr deployment to Lambda ARM64
cargo build --release --target aarch64-unknown-linux-gnu
zip lambda.zip target/aarch64-unknown-linux-gnu/release/inference
# Done. No Docker, no cross-compilation toolchain, no prayers.
</code></pre>
<h3 id="why-3-why-does-wasm-support-matter"><a class="header" href="#why-3-why-does-wasm-support-matter">Why #3: Why does WASM support matter?</a></h3>
<p><strong>Skeptic:</strong> &quot;ML in the browser is a toy. Serious inference runs on servers.&quot;</p>
<p><strong>Answer:</strong> WASM isn't just browsers. It's:</p>
<ol>
<li><strong>Cloudflare Workers</strong> - 0ms cold start, runs at edge (200+ cities)</li>
<li><strong>Fastly Compute</strong> - Sub-millisecond inference at edge</li>
<li><strong>Vercel Edge Functions</strong> - Next.js with embedded ML</li>
<li><strong>Embedded WASM</strong> - Wasmtime on IoT devices</li>
<li><strong>Plugin systems</strong> - Sandboxed ML in any application</li>
</ol>
<pre><code class="language-rust ignore">// Same model, same code, runs everywhere
#[cfg(target_arch = &quot;wasm32&quot;)]
use aprender::format::load_from_bytes;

const MODEL: &amp;[u8] = include_bytes!(&quot;model.apr&quot;);

pub fn predict(input: &amp;[f32]) -&gt; Vec&lt;f32&gt; {
    let model: RandomForest = load_from_bytes(MODEL, ModelType::RandomForest)
        .expect(&quot;embedded model is valid&quot;);
    model.predict_proba(input)
}</code></pre>
<p><strong>Business case:</strong> A Cloudflare Worker costs $0.50/million requests. A GPU VM costs $500+/month. For classification tasks, edge inference is 1000x cheaper.</p>
<h3 id="why-4-why-embed-models-in-binaries"><a class="header" href="#why-4-why-embed-models-in-binaries">Why #4: Why embed models in binaries?</a></h3>
<p><strong>Skeptic:</strong> &quot;Just download models at runtime like everyone else.&quot;</p>
<p><strong>Answer:</strong> Runtime downloads create these failure modes:</p>
<div class="table-wrapper"><table><thead><tr><th>Failure Mode</th><th>Probability</th><th>Impact</th></tr></thead><tbody>
<tr><td>Network unavailable</td><td>Common (planes, submarines, air-gapped)</td><td>Total failure</td></tr>
<tr><td>CDN outage</td><td>Rare but catastrophic</td><td>All users affected</td></tr>
<tr><td>Model URL changes</td><td>Common over years</td><td>Silent breakage</td></tr>
<tr><td>Version mismatch</td><td>Common</td><td>Undefined behavior</td></tr>
<tr><td>Man-in-the-middle</td><td>Possible</td><td>Security breach</td></tr>
</tbody></table>
</div>
<p><strong>Embedded models eliminate all of these:</strong></p>
<pre><code class="language-rust ignore">// Model is part of the binary. No network. No CDN. No MITM.
const MODEL: &amp;[u8] = include_bytes!(&quot;../models/classifier.apr&quot;);

fn main() {
    // This CANNOT fail due to network issues
    let model: DecisionTree = load_from_bytes(MODEL, ModelType::DecisionTree)
        .expect(&quot;compile-time verified model&quot;);

    // Binary hash includes model - tamper-evident
    // Version is locked at compile time - no drift
}</code></pre>
<p><strong>Size impact:</strong> A quantized decision tree is ~50KB. Your binary grows by 50KB. That's nothing.</p>
<h3 id="why-5-why-does-encryption-belong-in-the-format"><a class="header" href="#why-5-why-does-encryption-belong-in-the-format">Why #5: Why does encryption belong in the format?</a></h3>
<p><strong>Skeptic:</strong> &quot;Encrypt at the filesystem level. Don't bloat the format.&quot;</p>
<p><strong>Answer:</strong> Filesystem encryption doesn't travel with the model:</p>
<pre><code class="language-text">Scenario: Share trained model with partner company

Filesystem encryption:
1. Encrypt model file with GPG
2. Send encrypted file + password via separate channel
3. Partner decrypts to filesystem
4. Model now sits unencrypted on their disk
5. Partner's intern accidentally commits it to GitHub
6. Model leaked. Game over.

.apr encryption:
1. Encrypt model for partner's X25519 public key
2. Send .apr file (password never transmitted)
3. Partner loads directly - decryption in memory only
4. Model NEVER exists unencrypted on disk
5. Intern commits .apr file? Useless without private key.
</code></pre>
<pre><code class="language-rust ignore">use aprender::format::{save_for_recipient, load_as_recipient};
use aprender::format::x25519::{PublicKey, SecretKey};

// Sender: Encrypt for specific recipient
save_for_recipient(&amp;model, ModelType::Custom, &quot;partner.apr&quot;, opts, &amp;partner_public_key)?;

// Recipient: Decrypt with their secret key (model never touches disk unencrypted)
let model: MyModel = load_as_recipient(&quot;partner.apr&quot;, ModelType::Custom, &amp;my_secret_key)?;</code></pre>
<h2 id="deep-dive-json-metadata"><a class="header" href="#deep-dive-json-metadata">Deep Dive: JSON Metadata</a></h2>
<h3 id="why-metadata-in-model-files"><a class="header" href="#why-metadata-in-model-files">Why Metadata in Model Files?</a></h3>
<p>Models often need more than just weights. Tokenizers, vocabulary, config, and custom data should travel with the model:</p>
<div class="table-wrapper"><table><thead><tr><th>Data Type</th><th>Without Metadata</th><th>With .apr Metadata</th></tr></thead><tbody>
<tr><td>Vocabulary</td><td>Separate <code>vocab.json</code></td><td>Embedded in model</td></tr>
<tr><td>Config</td><td>Separate <code>config.yaml</code></td><td>Embedded in model</td></tr>
<tr><td>Tokenizer</td><td>Separate <code>tokenizer.json</code></td><td>Embedded in model</td></tr>
<tr><td>Custom</td><td>Application-specific files</td><td>Single <code>.apr</code> file</td></tr>
</tbody></table>
</div>
<h3 id="tokenizer-preservation-pmat-apr-tok-001"><a class="header" href="#tokenizer-preservation-pmat-apr-tok-001">Tokenizer Preservation (PMAT-APR-TOK-001)</a></h3>
<p><strong>Critical Feature (v1.2.0):</strong> APR files now automatically embed tokenizers during conversion, making them truly self-contained portable files.</p>
<div class="table-wrapper"><table><thead><tr><th>Conversion Path</th><th>Tokenizer Source</th><th>Preservation</th></tr></thead><tbody>
<tr><td>SafeTensors → APR</td><td>Sibling <code>tokenizer.json</code></td><td>✅ Embedded in APR metadata</td></tr>
<tr><td>GGUF → APR</td><td>GGUF vocabulary tensors</td><td>✅ Embedded in APR metadata</td></tr>
<tr><td>APR Inference</td><td>APR metadata</td><td>✅ Automatic token decoding</td></tr>
</tbody></table>
</div>
<p><strong>Tokenizer Metadata Keys:</strong></p>
<ul>
<li><code>tokenizer.vocabulary</code> - Full vocabulary list (e.g., 151,643 tokens for Qwen2.5)</li>
<li><code>tokenizer.vocab_size</code> - Vocabulary size</li>
<li><code>tokenizer.bos_token_id</code> - Beginning-of-sequence token ID</li>
<li><code>tokenizer.eos_token_id</code> - End-of-sequence token ID</li>
<li><code>tokenizer.model_type</code> - Tokenizer type (BPE, etc.)</li>
</ul>
<p><strong>Verification:</strong></p>
<pre><code class="language-bash"># Check if tokenizer is embedded
strings model.apr | grep &quot;tokenizer.vocabulary&quot;

# Verify vocabulary size
apr inspect model.apr --json | jq '.metadata.tokenizer.vocab_size'
</code></pre>
<h3 id="using-json-metadata"><a class="header" href="#using-json-metadata">Using JSON Metadata</a></h3>
<pre><code class="language-rust ignore">use aprender::serialization::apr::{AprWriter, AprReader};
use serde_json::json;

// Create model with metadata
let mut writer = AprWriter::new();

// Add arbitrary JSON metadata
writer.set_metadata(&quot;model_type&quot;, json!(&quot;whisper-tiny&quot;));
writer.set_metadata(&quot;n_vocab&quot;, json!(51865));
writer.set_metadata(&quot;tokenizer&quot;, json!({
    &quot;tokens&quot;: [&quot;&lt;|endoftext|&gt;&quot;, &quot;&lt;|startoftranscript|&gt;&quot;, &quot;the&quot;, &quot;a&quot;],
    &quot;merges&quot;: [[&quot;t&quot;, &quot;h&quot;], [&quot;th&quot;, &quot;e&quot;]],
    &quot;special_tokens&quot;: {&quot;eot&quot;: 50256, &quot;sot&quot;: 50257}
}));

// Add tensors
writer.add_tensor_f32(&quot;encoder.weight&quot;, vec![384, 80], &amp;weights);

// Write single file
let bytes = writer.to_bytes()?;

// Read back
let reader = AprReader::from_bytes(bytes)?;
let tokenizer = reader.get_metadata(&quot;tokenizer&quot;).unwrap();
let weights = reader.read_tensor_f32(&quot;encoder.weight&quot;)?;</code></pre>
<h3 id="wasm-deployment-with-embedded-vocab"><a class="header" href="#wasm-deployment-with-embedded-vocab">WASM Deployment with Embedded Vocab</a></h3>
<p>This is the killer feature for browser-based ML:</p>
<pre><code class="language-rust ignore">// Build time: single file with everything
const MODEL: &amp;[u8] = include_bytes!(&quot;whisper-tiny.apr&quot;);

// Runtime: no network requests, no additional files
fn transcribe(audio: &amp;[f32]) -&gt; String {
    let reader = AprReader::from_bytes(MODEL.to_vec()).unwrap();

    // Vocab embedded in model
    let vocab = reader.get_metadata(&quot;tokenizer&quot;).unwrap();
    let tokens = vocab[&quot;tokens&quot;].as_array().unwrap();

    // Weights embedded in model
    let encoder_weight = reader.read_tensor_f32(&quot;encoder.weight&quot;).unwrap();

    // ... inference logic
}</code></pre>
<p><strong>Example:</strong> <code>cargo run --example apr_with_metadata</code></p>
<h2 id="deep-dive-trueno-integration"><a class="header" href="#deep-dive-trueno-integration">Deep Dive: trueno Integration</a></h2>
<h3 id="what-is-trueno"><a class="header" href="#what-is-trueno">What is trueno?</a></h3>
<p>trueno is aprender's SIMD and GPU-accelerated tensor library. Unlike NumPy/PyTorch:</p>
<ul>
<li><strong>Pure Rust</strong> - No C/C++/Fortran/CUDA SDK required</li>
<li><strong>Auto-vectorization</strong> - Compiler generates optimal SIMD for your CPU</li>
<li><strong>Six SIMD backends</strong> - scalar, SSE2, AVX2, AVX-512, NEON (ARM), WASM SIMD128</li>
<li><strong>GPU backend</strong> - wgpu (Vulkan/Metal/DX12/WebGPU) for 10-50x speedups</li>
<li><strong>Same API everywhere</strong> - Code runs identically on x86, ARM, browsers, GPUs</li>
</ul>
<h3 id="why-trueno--apr"><a class="header" href="#why-trueno--apr">Why trueno + .apr?</a></h3>
<p>The <code>TRUENO_NATIVE</code> flag (bit 4) enables zero-copy tensor loading:</p>
<pre><code class="language-text">Traditional loading:
1. Read file bytes
2. Deserialize to intermediate format
3. Allocate new tensors
4. Copy data into tensors
Time: O(n) allocations + O(n) copies

trueno-native loading:
1. mmap file
2. Cast pointer to tensor
3. Done
Time: O(1) - just pointer arithmetic
</code></pre>
<pre><code class="language-rust ignore">// Standard loading (~100ms for 1GB model)
let model: NeuralNet = load(&quot;model.apr&quot;, ModelType::NeuralSequential)?;

// trueno-native loading (~0.1ms for 1GB model)
// Requires TRUENO_NATIVE flag set during save
let model: NeuralNet = load_mmap(&quot;model.apr&quot;, ModelType::NeuralSequential)?;</code></pre>
<p><strong>Benchmark: 1GB model load time</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Time</th><th>Memory Overhead</th></tr></thead><tbody>
<tr><td>PyTorch (pickle)</td><td>2.3s</td><td>2x model size</td></tr>
<tr><td>SafeTensors</td><td>450ms</td><td>1x model size</td></tr>
<tr><td>GGUF</td><td>380ms</td><td>1x model size</td></tr>
<tr><td>.apr (standard)</td><td>320ms</td><td>1x model size</td></tr>
<tr><td>.apr (trueno-native)</td><td><strong>0.8ms</strong></td><td><strong>0x</strong> (mmap)</td></tr>
</tbody></table>
</div>
<h2 id="deep-dive-arm-and-embedded-deployment"><a class="header" href="#deep-dive-arm-and-embedded-deployment">Deep Dive: ARM and Embedded Deployment</a></h2>
<h3 id="the-problem-with-traditional-ml-deployment"><a class="header" href="#the-problem-with-traditional-ml-deployment">The Problem with Traditional ML Deployment</a></h3>
<pre><code class="language-text">Traditional: Python → ONNX → TensorRT/OpenVINO → Deploy
- Requires Python for training
- Requires ONNX export (lossy, not all ops supported)
- Requires vendor-specific runtime (TensorRT = NVIDIA only)
- Requires significant RAM for runtime
- Cold start: seconds
</code></pre>
<h3 id="the-apr-solution"><a class="header" href="#the-apr-solution">The .apr Solution</a></h3>
<pre><code class="language-text">aprender: Rust → .apr → Deploy
- Training and inference in same language
- Native format (no export step)
- No vendor lock-in
- Minimal RAM (no runtime)
- Cold start: microseconds
</code></pre>
<h3 id="real-world-raspberry-pi-deployment"><a class="header" href="#real-world-raspberry-pi-deployment">Real-World: Raspberry Pi Deployment</a></h3>
<pre><code class="language-bash"># On your development machine (any OS)
cross build --release --target armv7-unknown-linux-gnueabihf

# Copy single binary to Pi
scp target/armv7-unknown-linux-gnueabihf/release/inference pi@raspberrypi:~/

# On Pi: Just run it
./inference --model embedded  # Model is IN the binary
</code></pre>
<p><strong>Resource comparison on Raspberry Pi 4:</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Framework</th><th>Binary Size</th><th>RAM Usage</th><th>Inference Time</th></tr></thead><tbody>
<tr><td>TensorFlow Lite</td><td>2.1 MB</td><td>89 MB</td><td>45ms</td></tr>
<tr><td>ONNX Runtime</td><td>8.3 MB</td><td>156 MB</td><td>38ms</td></tr>
<tr><td>.apr (aprender)</td><td><strong>420 KB</strong></td><td><strong>12 MB</strong></td><td><strong>31ms</strong></td></tr>
</tbody></table>
</div>
<h3 id="real-world-aws-lambda-deployment"><a class="header" href="#real-world-aws-lambda-deployment">Real-World: AWS Lambda Deployment</a></h3>
<pre><code class="language-rust ignore">// lambda/src/main.rs
use lambda_runtime::{service_fn, LambdaEvent, Error};
use aprender::format::load_from_bytes;
use aprender::tree::DecisionTreeClassifier;

// Model embedded at compile time - no S3, no cold start penalty
const MODEL: &amp;[u8] = include_bytes!(&quot;../model.apr&quot;);

async fn handler(event: LambdaEvent&lt;Request&gt;) -&gt; Result&lt;Response, Error&gt; {
    // Load from embedded bytes (microseconds, not seconds)
    let model: DecisionTreeClassifier = load_from_bytes(MODEL, ModelType::DecisionTree)?;

    let prediction = model.predict(&amp;event.payload.features);
    Ok(Response { prediction })
}

#[tokio::main]
async fn main() -&gt; Result&lt;(), Error&gt; {
    lambda_runtime::run(service_fn(handler)).await
}</code></pre>
<p><strong>Lambda performance comparison:</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Approach</th><th>Cold Start</th><th>Warm Inference</th><th>Cost/1M requests</th></tr></thead><tbody>
<tr><td>SageMaker endpoint</td><td>N/A (always on)</td><td>50ms</td><td>$43.80</td></tr>
<tr><td>Lambda + S3 model</td><td>3.2s</td><td>180ms</td><td>$0.60</td></tr>
<tr><td>Lambda + .apr embedded</td><td><strong>180ms</strong></td><td><strong>12ms</strong></td><td><strong>$0.20</strong></td></tr>
</tbody></table>
</div>
<h2 id="deep-dive-security-model"><a class="header" href="#deep-dive-security-model">Deep Dive: Security Model</a></h2>
<h3 id="threat-model"><a class="header" href="#threat-model">Threat Model</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Threat</th><th>GGUF</th><th>SafeTensors</th><th>.apr</th></tr></thead><tbody>
<tr><td>Model theft (disk access)</td><td>Vulnerable</td><td>Vulnerable</td><td><strong>Encrypted at rest</strong></td></tr>
<tr><td>Model theft (memory dump)</td><td>Vulnerable</td><td>Vulnerable</td><td><strong>Encrypted in memory</strong></td></tr>
<tr><td>Tampering detection</td><td>None</td><td>None</td><td><strong>Ed25519 signatures</strong></td></tr>
<tr><td>Supply chain attack</td><td>No verification</td><td>No verification</td><td><strong>Signed provenance</strong></td></tr>
<tr><td>Unauthorized redistribution</td><td>No protection</td><td>No protection</td><td><strong>Recipient encryption</strong></td></tr>
</tbody></table>
</div>
<h3 id="encryption-architecture"><a class="header" href="#encryption-architecture">Encryption Architecture</a></h3>
<pre><code class="language-text">┌─────────────────────────────────────────────────────────────┐
│                     .apr File Structure                      │
├─────────────────────────────────────────────────────────────┤
│ Header (32 bytes)                                            │
│   Magic: &quot;APR\x00&quot;                                          │
│   Version: 1                                                │
│   Flags: ENCRYPTED | SIGNED                                 │
│   Model Type, Compression, Sizes...                         │
├─────────────────────────────────────────────────────────────┤
│ Encryption Block (when ENCRYPTED flag set)                   │
│   Mode: Password | Recipient                                │
│   Salt (16 bytes) | Ephemeral Public Key (32 bytes)         │
│   Nonce (12 bytes)                                          │
├─────────────────────────────────────────────────────────────┤
│ Encrypted Payload                                            │
│   AES-256-GCM ciphertext                                    │
│   (Metadata + Model weights)                                │
├─────────────────────────────────────────────────────────────┤
│ Signature Block (when SIGNED flag set)                       │
│   Ed25519 signature (64 bytes)                              │
│   Signs: Header || Encrypted Payload                        │
├─────────────────────────────────────────────────────────────┤
│ CRC32 Checksum (4 bytes)                                     │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<h3 id="password-encryption-aes-256-gcm--argon2id"><a class="header" href="#password-encryption-aes-256-gcm--argon2id">Password Encryption (AES-256-GCM + Argon2id)</a></h3>
<pre><code class="language-rust ignore">use aprender::format::{save_encrypted, load_encrypted, ModelType};

// Save with password protection
save_encrypted(&amp;model, ModelType::RandomForest, &quot;secret.apr&quot;, opts, &quot;hunter2&quot;)?;

// Argon2id parameters (OWASP recommended):
// - Memory: 19 MiB (GPU-resistant)
// - Iterations: 2
// - Parallelism: 1
// Derivation time: ~200ms (intentionally slow for brute-force resistance)

// Load requires correct password
let model: RandomForest = load_encrypted(&quot;secret.apr&quot;, ModelType::RandomForest, &quot;hunter2&quot;)?;

// Wrong password: DecryptionFailed error (no partial data leaked)
let result = load_encrypted::&lt;RandomForest&gt;(&quot;secret.apr&quot;, ModelType::RandomForest, &quot;wrong&quot;);
assert!(result.is_err());</code></pre>
<h3 id="recipient-encryption-x25519--hkdf--aes-256-gcm"><a class="header" href="#recipient-encryption-x25519--hkdf--aes-256-gcm">Recipient Encryption (X25519 + HKDF + AES-256-GCM)</a></h3>
<pre><code class="language-rust ignore">use aprender::format::{save_for_recipient, load_as_recipient};
use aprender::format::x25519::generate_keypair;

// Recipient generates keypair, shares public key
let (recipient_secret, recipient_public) = generate_keypair();

// Sender encrypts for recipient (no shared password!)
save_for_recipient(&amp;model, ModelType::Custom, &quot;for_alice.apr&quot;, opts, &amp;recipient_public)?;

// Only recipient can decrypt
let model: MyModel = load_as_recipient(&quot;for_alice.apr&quot;, ModelType::Custom, &amp;recipient_secret)?;

// Benefits:
// - No password transmission required
// - Forward secrecy (ephemeral sender keys)
// - Non-transferable (cryptographically bound to recipient)</code></pre>
<h2 id="addressing-common-objections"><a class="header" href="#addressing-common-objections">Addressing Common Objections</a></h2>
<h3 id="but-i-need-to-use-huggingface-models"><a class="header" href="#but-i-need-to-use-huggingface-models">&quot;But I need to use HuggingFace models&quot;</a></h3>
<p><strong>Answer:</strong> We support export to SafeTensors for HuggingFace compatibility:</p>
<pre><code class="language-rust ignore">use aprender::format::export_safetensors;

// Train in aprender
let model = train_transformer(&amp;data)?;

// Export for HuggingFace
export_safetensors(&amp;model, &quot;model.safetensors&quot;)?;

// Or import from HuggingFace
let model = import_safetensors::&lt;Transformer&gt;(&quot;downloaded.safetensors&quot;)?;</code></pre>
<h3 id="but-gguf-has-better-quantization"><a class="header" href="#but-gguf-has-better-quantization">&quot;But GGUF has better quantization&quot;</a></h3>
<p><strong>Answer:</strong> We implement GGUF-compatible quantization:</p>
<pre><code class="language-rust ignore">use aprender::format::{QuantType, Quantizer};

// Same block sizes as GGUF for compatibility
let quantized = model.quantize(QuantType::Q4_0)?; // 4-bit, 32-element blocks

// Can export to GGUF for llama.cpp compatibility
export_gguf(&amp;quantized, &quot;model.gguf&quot;)?;</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Quant Type</th><th>Bits</th><th>Block Size</th><th>GGUF Equivalent</th></tr></thead><tbody>
<tr><td>Q8_0</td><td>8</td><td>32</td><td>GGML_TYPE_Q8_0</td></tr>
<tr><td>Q4_0</td><td>4</td><td>32</td><td>GGML_TYPE_Q4_0</td></tr>
<tr><td>Q4_1</td><td>4+min</td><td>32</td><td>GGML_TYPE_Q4_1</td></tr>
</tbody></table>
</div>
<h3 id="but-onnx-is-the-industry-standard"><a class="header" href="#but-onnx-is-the-industry-standard">&quot;But ONNX is the industry standard&quot;</a></h3>
<p><strong>Answer:</strong> ONNX requires a C++ runtime. That means:</p>
<ul>
<li>No WASM (browsers, edge)</li>
<li>No embedded (microcontrollers)</li>
<li>Complex cross-compilation</li>
<li>Large binary size (+50MB runtime)</li>
</ul>
<p>If you need ONNX compatibility for legacy systems:</p>
<pre><code class="language-rust ignore">// Export for legacy systems that require ONNX
export_onnx(&amp;model, &quot;model.onnx&quot;)?;

// But for new deployments, .apr is smaller, faster, and more portable</code></pre>
<h3 id="but-i-need-gpu-inference"><a class="header" href="#but-i-need-gpu-inference">&quot;But I need GPU inference&quot;</a></h3>
<p><strong>Answer:</strong> trueno has <strong>production-ready GPU support</strong> via wgpu (Vulkan/Metal/DX12/WebGPU):</p>
<pre><code class="language-rust ignore">use trueno::backends::gpu::GpuBackend;

// GPU backend with cross-platform support
let mut gpu = GpuBackend::new();

// Check availability at runtime
if GpuBackend::is_available() {
    // Matrix multiplication: 10-50x faster than SIMD for large matrices
    let result = gpu.matmul(&amp;a, &amp;b, m, k, n)?;

    // All neural network activations on GPU
    let relu_out = gpu.relu(&amp;input)?;
    let sigmoid_out = gpu.sigmoid(&amp;input)?;
    let gelu_out = gpu.gelu(&amp;input)?;      // Transformers
    let softmax_out = gpu.softmax(&amp;input)?; // Classification

    // 2D convolution for CNNs
    let conv_out = gpu.convolve2d(&amp;input, &amp;kernel, h, w, kh, kw)?;
}

// Same .apr model file works on CPU (SIMD) and GPU - backend is runtime choice</code></pre>
<p><strong>trueno GPU capabilities:</strong></p>
<ul>
<li><strong>Backends</strong>: Vulkan, Metal, DirectX 12, WebGPU (browsers!)</li>
<li><strong>Operations</strong>: matmul, dot, relu, leaky_relu, elu, sigmoid, tanh, swish, gelu, softmax, log_softmax, conv2d, clip</li>
<li><strong>Performance</strong>: 10-50x speedup for matmul (1000×1000+), 5-20x for reductions (100K+ elements)</li>
</ul>
<h2 id="summary-when-to-use-apr"><a class="header" href="#summary-when-to-use-apr">Summary: When to Use .apr</a></h2>
<p><strong>Use .apr when:</strong></p>
<ul>
<li>Deploying to browsers (WASM)</li>
<li>Deploying to edge (Cloudflare Workers, Lambda@Edge)</li>
<li>Deploying to embedded (Raspberry Pi, IoT)</li>
<li>Deploying to serverless (AWS Lambda, Azure Functions)</li>
<li>Model security matters (encryption, signing)</li>
<li>Single-binary deployment is desired</li>
<li>Cross-platform builds are needed</li>
<li>Supply chain security is required</li>
</ul>
<p><strong>Use GGUF when:</strong></p>
<ul>
<li>Specifically running llama.cpp</li>
<li>LLM inference is the only use case</li>
<li>C/C++ toolchain is acceptable</li>
</ul>
<p><strong>Use SafeTensors when:</strong></p>
<ul>
<li>HuggingFace ecosystem integration is primary goal</li>
<li>Python is the deployment target</li>
</ul>
<p><strong>Use ONNX when:</strong></p>
<ul>
<li>Legacy system integration required</li>
<li>Vendor runtime (TensorRT, OpenVINO) is acceptable</li>
</ul>
<h2 id="code-complete-apr-workflow"><a class="header" href="#code-complete-apr-workflow">Code: Complete .apr Workflow</a></h2>
<pre><code class="language-rust ignore">//! Complete .apr workflow: train, save, encrypt, deploy
//!
//! cargo run --example apr_workflow

use aprender::prelude::*;
use aprender::format::{
    save, load, save_encrypted, load_encrypted,
    save_for_recipient, load_as_recipient,
    ModelType, SaveOptions,
};
use aprender::tree::DecisionTreeClassifier;

fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    // 1. Train a model
    let (x_train, y_train) = load_iris_dataset()?;
    let mut model = DecisionTreeClassifier::new().with_max_depth(5);
    model.fit(&amp;x_train, &amp;y_train)?;

    println!(&quot;Model trained. Accuracy: {:.2}%&quot;, model.score(&amp;x_train, &amp;y_train)? * 100.0);

    // 2. Save with metadata
    let options = SaveOptions::default()
        .with_name(&quot;iris-classifier&quot;)
        .with_description(&quot;Decision tree for Iris classification&quot;)
        .with_author(&quot;ML Team&quot;);

    save(&amp;model, ModelType::DecisionTree, &quot;model.apr&quot;, options.clone())?;
    println!(&quot;Saved to model.apr&quot;);

    // 3. Save encrypted (password)
    save_encrypted(&amp;model, ModelType::DecisionTree, &quot;model-encrypted.apr&quot;,
                   options.clone(), &quot;secret-password&quot;)?;
    println!(&quot;Saved encrypted to model-encrypted.apr&quot;);

    // 4. Load and verify
    let loaded: DecisionTreeClassifier = load(&quot;model.apr&quot;, ModelType::DecisionTree)?;
    assert_eq!(loaded.score(&amp;x_train, &amp;y_train)?, model.score(&amp;x_train, &amp;y_train)?);
    println!(&quot;Loaded and verified!&quot;);

    // 5. Load encrypted
    let loaded_enc: DecisionTreeClassifier =
        load_encrypted(&quot;model-encrypted.apr&quot;, ModelType::DecisionTree, &quot;secret-password&quot;)?;
    println!(&quot;Loaded encrypted model!&quot;);

    // 6. Demonstrate embedded deployment
    println!(&quot;\nFor embedded deployment, add to your binary:&quot;);
    println!(&quot;  const MODEL: &amp;[u8] = include_bytes!(\&quot;model.apr\&quot;);&quot;);
    println!(&quot;  let model: DecisionTreeClassifier = load_from_bytes(MODEL, ModelType::DecisionTree)?;&quot;);

    // Cleanup
    std::fs::remove_file(&quot;model.apr&quot;)?;
    std::fs::remove_file(&quot;model-encrypted.apr&quot;)?;

    Ok(())
}

fn load_iris_dataset() -&gt; Result&lt;(Matrix&lt;f32&gt;, Vec&lt;usize&gt;), Box&lt;dyn std::error::Error&gt;&gt; {
    // Simplified Iris dataset
    let x = Matrix::from_vec(12, 4, vec![
        5.1, 3.5, 1.4, 0.2,  // setosa
        4.9, 3.0, 1.4, 0.2,
        7.0, 3.2, 4.7, 1.4,  // versicolor
        6.4, 3.2, 4.5, 1.5,
        6.3, 3.3, 6.0, 2.5,  // virginica
        5.8, 2.7, 5.1, 1.9,
        5.0, 3.4, 1.5, 0.2,  // setosa
        4.4, 2.9, 1.4, 0.2,
        6.9, 3.1, 4.9, 1.5,  // versicolor
        5.5, 2.3, 4.0, 1.3,
        6.5, 3.0, 5.8, 2.2,  // virginica
        7.6, 3.0, 6.6, 2.1,
    ])?;
    let y = vec![0, 0, 1, 1, 2, 2, 0, 0, 1, 1, 2, 2];
    Ok((x, y))
}</code></pre>
<h2 id="further-reading"><a class="header" href="#further-reading">Further Reading</a></h2>
<ul>
<li><a href="./model-format.html">Model Format Specification</a> - Complete technical spec</li>
<li><a href="./shell-history-developer-guide.html">Shell History Developer Guide</a> - Real-world .apr usage</li>
<li>Encryption Features - Security deep dive (planned)</li>
<li><a href="https://docs.rs/trueno">trueno Documentation</a> - SIMD tensor library</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../examples/model-format.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../examples/model-bundling-paging.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../examples/model-format.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../examples/model-bundling-paging.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../editor.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
